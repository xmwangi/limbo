FROM ubuntu

ENV PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# get our basic-needs sorted
RUN apt-get update

RUN apt-get -y install apt-utils locales
RUN locale-gen en_US.UTF-8  
ENV LANG en_US.UTF-8  
ENV LANGUAGE en_US:en  
ENV LC_ALL en_US.UTF-8

RUN apt-get -y install gcc libffi-dev libssl-dev 
RUN apt-get -y install python3 python3-pip python3-dev
RUN ln -s /usr/bin/pip3 /usr/bin/pip
RUN ln -s /usr/bin/python3 /usr/bin/python
RUN pip install --upgrade pip setuptools

RUN pip install awscli --upgrade

RUN apt-get -y install curl
RUN curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
RUN chmod +x /usr/local/bin/ecs-cli

RUN mkdir -p /opt /app
WORKDIR /app

RUN apt-get -y install libjpeg8-dev
ADD requirements.txt /app
RUN pip install -r requirements.txt
RUN pip install --upgrade \
  https://storage.googleapis.com/tensorflow/linux/cpu/protobuf-3.1.0-cp35-none-linux_x86_64.whl
ADD force_keras_model.py /app
RUN python3 force_keras_model.py


ADD . /app
RUN python3 setup.py install

RUN rm -rf build dist limbo.egg-info

ENV PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION python

CMD pytest --cov=limbo --cov-report term-missing test

# vim: set expandtab tabstop=4 shiftwidth=4 autoindent smartindent:
